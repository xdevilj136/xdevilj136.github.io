<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nodejså¿«é€Ÿæ¥å…¥GraphQL | Gridea</title>
<link rel="shortcut icon" href="https://xdevilj136.github.io//favicon.ico?v=1590910815187">
<link href="https://cdn.remixicon.com/releases/v2.1.0/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://xdevilj136.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Nodejså¿«é€Ÿæ¥å…¥GraphQL | Gridea - Atom Feed" href="https://xdevilj136.github.io//atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="1. GraphQLç®€ä»‹
1.1 GraphQL
GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„è¿è¡Œæ—¶å·¥å…·ã€‚ GraphQL å¯¹ API ä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®..." />
    <meta name="keywords" content="nodejs,graphql,koa" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://xdevilj136.github.io/">
  <img class="avatar" src="https://xdevilj136.github.io//images/avatar.png?v=1590910815187" alt="">
  </a>
  <h1 class="site-title">
    Gridea
  </h1>
  <p class="site-description">
    æ¸©æ•…è€ŒçŸ¥æ–°
  </p>
  <div class="menu-container">
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/xdevilj136/xdevilj136.github.io" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Nodejså¿«é€Ÿæ¥å…¥GraphQL
            </h2>
            <div class="post-info">
              <span>
                2020-05-30
              </span>
              <span>
                10 min read
              </span>
              
                <a href="https://xdevilj136.github.io/tag/yJkykW2pf/" class="post-tag">
                  # nodejs
                </a>
              
                <a href="https://xdevilj136.github.io/tag/vFTsOvTN7J/" class="post-tag">
                  # graphql
                </a>
              
                <a href="https://xdevilj136.github.io/tag/8xC6dOkIV_/" class="post-tag">
                  # koa
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://xdevilj136.github.io//post-images/nodejs-quick-access-graphql.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h2 id="1-graphqlç®€ä»‹">1. GraphQLç®€ä»‹</h2>
<h3 id="11-graphql">1.1 GraphQL</h3>
<p>GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„è¿è¡Œæ—¶å·¥å…·ã€‚ GraphQL å¯¹ API ä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œæ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œè®©å‰åç«¯å¼€å‘è”è°ƒæ•ˆç‡æ›´é«˜ï¼Œä¹Ÿè®© API æ›´å®¹æ˜“æ›´æ–°å’Œç»´æŠ¤ã€‚<br>
ä½¿ç”¨æ•ˆæœç±»ä¼¼ï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590820156986.gif" alt="" width="500" loading="lazy"></p>
<p>GraphQLçš„å¥½å¤„ä¸ä»…é™äºæ­¤ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¯·æ±‚ä½ æ‰€è¦çš„æ•°æ®ï¼Œä¸å¤šä¸å°‘, å‡å°‘APIè¯·æ±‚çš„æ•°æ®å†—ä½™å’Œè¯·æ±‚å†—ä½™</li>
<li>å…·æœ‰çµæ´»ä¸”å¼ºç±»å‹çš„schemaï¼Œæ–¹ä¾¿å®šä¹‰æ¥å£åè®®ï¼Œä¸”å…·æœ‰å¼ºç±»å‹æ ¡éªŒ</li>
<li>å¯æå‡è”è°ƒã€å¼€å‘æ•ˆç‡ï¼ŒAPIæ˜“äºæ›´æ–°å’Œç»´æŠ¤</li>
</ol>
<h3 id="12-apollo-graphqlç»„ä»¶">1.2 Apollo Graphqlç»„ä»¶</h3>
<p>Apollo GraphQL æ˜¯åŸºäº GraphQL çš„å…¨æ ˆè§£å†³æ–¹æ¡ˆé›†åˆã€‚å®ƒå¼€æºæä¾›äº†graphqlå‰ç«¯åˆ°åç«¯çš„ä¸€æ•´å¥—è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Apollo Client å’Œ Apollo Serverç­‰ã€‚è®© GraphQL ä½¿ç”¨æ›´åŠ ç®€å•ï¼Œé™ä½äº†ä½¿ç”¨é—¨æ§›ã€‚<br>
Apollo Serveræä¾›nodeç«¯å¼€ç®±å³ç”¨çš„æ¡†æ¶ä¸­é—´ä»¶ï¼Œæ¶µç›–expresså’Œkoaï¼›Apollo ClientåŒæ ·ä¹Ÿæœ‰å¯¹åº”çš„å‰ç«¯reactã€angularjsã€vueçš„ç»„ä»¶ï¼Œå¯ä»¥ç›´æ¥å¼•å…¥ä½¿å‰ç«¯è°ƒç”¨æ›´åŠ ä¾¿æ·ã€‚</p>
<h2 id="2-demoé¡¹ç›®ä»‹ç»">2. demoé¡¹ç›®ä»‹ç»</h2>
<h3 id="21-æŠ€æœ¯æ ˆ">2.1 æŠ€æœ¯æ ˆ</h3>
<p>demoé¡¹ç›®æŠ€æœ¯æ ˆä¸ºnodejs(koa) + vue + webpack + mongodbï¼Œåç«¯æ¥å£ç”¨koa2å®ç°ï¼Œå‰ç«¯ä½¿ç”¨æ¡†æ¶vueå®ç°ï¼Œæ„å»ºå·¥å…·webpackï¼Œæ•°æ®åº“ä½¿ç”¨mongodbã€‚<br>
é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š<br>
â”œâ”€controller                   // åç«¯æœåŠ¡æ¥å£å®ç°<br>
â”œâ”€graphql                    // graphql schemaå®šä¹‰ä»¥åŠresolverå®ç°<br>
â”œâ”€routes                     // åç«¯æ¥å£è·¯ç”±<br>
â”œâ”€vue-dist                   // webå‰ç«¯buildç”Ÿæˆé™æ€ç›®æ ‡æ–‡ä»¶<br>
â””â”€web                      // webå‰ç«¯æºæ–‡ä»¶ä»¥åŠwebpacké…ç½®æ–‡ä»¶<br>
â””â”€src<br>
â”œâ”€assets<br>
â”œâ”€components<br>
â”œâ”€router<br>
â””â”€views</p>
<h3 id="22-é¡µé¢å±•ç¤º">2.2 é¡µé¢å±•ç¤º</h3>
<p>é¦–é¡µï¼ˆä¹¦ç±åˆ—è¡¨ï¼‰ï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590821764064.png" alt="" loading="lazy"><br>
ä¹¦ç±è¯¦æƒ…é¡µï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590821858637.png" alt="" loading="lazy"><br>
é¡µé¢ç»“æ„éå¸¸ç®€å•ï¼Œé¦–é¡µæ˜¯ä¸€ä¸ªä¹¦ç±åˆ—è¡¨é¡µé¢ï¼Œç‚¹å‡»ä¹¦ç±åç§°è·³è½¬åˆ°ä¹¦ç±è¯¦æƒ…é¡µï¼Œè¯¦æƒ…é¡µåŒ…å«ä¹¦ç±å¯¹åº”åç§°ã€å›¾ç‰‡ã€ä½œè€…åç§°ã€ä½œè€…å‡ºç‰ˆçš„å…¶ä»–ä¹¦ç±ä¿¡æ¯ã€‚</p>
<h3 id="23-é—®é¢˜åˆ†æ">2.3 é—®é¢˜åˆ†æ</h3>
<p>å¦‚æ­¤ç®€å•çš„å‰ç«¯é¡µé¢ï¼Œçœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†åˆ†ææ¥å£è°ƒç”¨å°±èƒ½å‘ç°restfulæ¥å£æ¯”è¾ƒæ™®éå­˜åœ¨çš„ä¸€äº›é—®é¢˜ã€‚<br>
<img src="https://xdevilj136.github.io//post-images/1590827243054.png" alt="" loading="lazy"></p>
<ul>
<li>
<ol>
<li>APIæ¥å£è¯·æ±‚æ•°è¿‡å¤š<br>
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¯¦æƒ…é¡µé¢å½“å‰ä¹¦ç±çš„ä¿¡æ¯å’Œä½œè€…å‡ºç‰ˆçš„å…¶ä»–ä¹¦ç±ä¿¡æ¯ï¼Œä¸€å…±è¦è°ƒç”¨ä¸‰æ¬¡ä¸åŒçš„APIæ¥å£æ¥è·å–æ•°æ®ï¼ˆé€šè¿‡ä¹¦ç±idè·å–å½“å‰ä¹¦ç±ä¿¡æ¯-&gt;æ ¹æ®ä½œè€…åç§°è·å–ä½œè€…å‡ºç‰ˆä¹¦ç±id-&gt;æ ¹æ®ä¹¦ç±idè·å–ä¹¦ç±ç›¸å…³ä¿¡æ¯ï¼‰ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ¥å£è¿”å›å­—æ®µå†—ä½™<br>
ä¹¦ç±åˆ—è¡¨é¡µåªéœ€è¦å±•ç¤ºä¹¦ç±idã€ä¹¦ç±åç§°å’Œå›¾ç‰‡ï¼Œç„¶è€Œå®é™…æ¥å£è¿”å›ä¼šæœ‰å¾ˆå¤šå†—ä½™çš„å­—æ®µï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590827580620.png" alt="" loading="lazy"><br>
éƒ¨åˆ†é¡¹ç›®ä¸­ï¼ŒåŒä¸€ä¸ªrestfulæ¥å£å¯èƒ½ä¼šæä¾›ç»™å¤šä¸ªé¡µé¢æˆ–ç»ˆç«¯ä½¿ç”¨ï¼Œè€Œä¸åŒè°ƒç”¨æ–¹éœ€è¦çš„æ•°æ®å†…å®¹ä¸å°½ç›¸åŒï¼Œåç«¯ä¸å¯èƒ½æ¯æ¬¡éƒ½é’ˆå¯¹ä¸åŒè°ƒç”¨æ–¹æ–°å¢æ¥å£ï¼Œæ‰€ä»¥åªèƒ½æœ€å¤§ç¨‹åº¦æ¶µç›–æ‰€éœ€è¦çš„å­—æ®µã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li>å­—æ®µæ ¡éªŒé—®é¢˜<br>
å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒè€—æ—¶å’Œå®¹æ˜“å‡ºå·®é”™çš„åœ°æ–¹ï¼Œå¾ˆå¤§æ¦‚ç‡éƒ½æ˜¯å‰åç«¯è”è°ƒã€‚åç«¯å¼€å‘æä¾›æ¥å£æ–‡æ¡£ç»™å‰ç«¯å¼€å‘äººå‘˜ï¼Œå‰ç«¯æ ¹æ®æ¥å£æ–‡æ¡£æ¥mockæˆ–ç›´æ¥è¯·æ±‚æ¥å£è¿›è¡Œè”è°ƒã€‚è”è°ƒä¸»è¦åœ¨äºå¯¹é½å­—æ®µåç§°å’Œå­—æ®µç±»å‹ï¼Œå¦‚æœè¯·æ±‚ä¸­å­—æ®µé”™è¯¯å¯¼è‡´BUGï¼Œè€Œåæ®µæ¥å£æç¤ºåˆæ¯”è¾ƒæ¨¡ç³Šå°±ä¼šæ¯”è¾ƒéš¾å®šä½é—®é¢˜ï¼›è€Œå¦‚æœæ¥å£æœ‰å˜åŠ¨ï¼Œåç«¯é€šè¿‡æ¥å£æ–‡æ¡£æ›´æ–°ç»´æŠ¤å¹¶é€šçŸ¥å‰ç«¯ï¼Œæˆæœ¬ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ã€‚</li>
</ol>
</li>
</ul>
<p>æ³¨ï¼šæœ¬demoé¡¹ç›®çš„æ¡ˆä¾‹å¹¶ä¸ä¸€å®šåˆç†ï¼Œä½†ä»¥ä¸Šæ˜¯restfulæ¥å£å®¹æ˜“é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>
<h2 id="3-æ¥å…¥graphql">3. æ¥å…¥GraphQL</h2>
<p>ä»¥ä¸Šdemoé¡¹ç›®çš„é—®é¢˜åŸºæœ¬éƒ½èƒ½ç”¨graphqlæ¥è§£å†³ï¼Œæœ¬æ–‡ä½¿ç”¨Apollo GraphQLçš„ä¸€ç³»åˆ—ç»„ä»¶å®ç°å¿«é€Ÿæ¥å…¥ã€‚</p>
<h3 id="31-å®šä¹‰schema">3.1 å®šä¹‰schema</h3>
<p>GraphQLå®˜æ–¹è§„èŒƒä½¿ç”¨schemaæ¥å®šä¹‰æ•°æ®ç»“æ„å’Œç±»å‹ï¼Œä»¥åŠè¯·æ±‚çš„ç±»å‹ã€‚æˆ‘ä»¬ä½¿ç”¨schemaå®šä¹‰è¯­è¨€ï¼ˆSDLï¼‰æ¥å®šä¹‰æœåŠ¡ç«¯å°†è¿”å›çš„æ•°æ®å¯¹è±¡ï¼ŒæŒ‡å®šå¯¹è±¡çš„å­—æ®µçš„ç±»å‹å’Œå­—æ®µåã€‚GraphQL serverçš„è¯·æ±‚å¤„ç†å’Œå­—æ®µæ ¡éªŒéƒ½ä¾èµ–äºå®šä¹‰å¥½çš„schemaã€‚ä¾‹å¦‚æœ¬demoæ‰€ç”¨åˆ°çš„æ¥å£å¯¹è±¡å¯å®šä¹‰å¦‚ä¸‹ (schema.js)ï¼š</p>
<pre><code class="language-javascript">// gqlæ ‡ç­¾å‡½æ•°ï¼Œç”¨äºè§£ææŸ¥è¯¢æ¨¡ç‰ˆå­—ç¬¦ä¸²ç”Ÿæˆgraphqlæ ‡å‡†çš„ASTä»¥ä¾¿ç»„ä»¶èƒ½è¿›è¡Œç»Ÿä¸€å¤„ç†
const { gql } = require(&quot;apollo-server-koa&quot;);

// Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query { 
    bookList(names: [String]): [BookInfo]
    bookDetail(id: String): BookDetail
  }
  type BookInfo {
    _id: String!
    name: String
    author: String
    isbn: String
    url: String
    img: String
  }
  type AuthorInfo {
    _id: String!
    name: String
    address: String
    company: String
    books: [BookInfo]
  }
  type BookDetail {
    bookInfo: BookInfo,
    authorInfo: AuthorInfo
  }
`;

module.exports = {
  typeDefs
};

</code></pre>
<p>ä»¥ä¸Šå®šä¹‰äº†ä¸‰ä¸ªè¯·æ±‚æ¥å£(type Query)ï¼Œä¸¤ä¸ªæ•°æ®å¯¹è±¡ï¼Œå¹¶å®šä¹‰äº†å¯¹åº”çš„æ•°æ®å­—æ®µå’Œç±»å‹ï¼›ä¾‹å¦‚ <code>bookInfo(id: String!): BookInfo</code> å®šä¹‰äº†è¯·æ±‚æ¥å£ï¼Œè¯·æ±‚å‚æ•°ä¸ºStringç±»å‹çš„idï¼Œå“åº”ä¸ºå®šä¹‰çš„æ•°æ®å¯¹è±¡BookInfoã€‚</p>
<h3 id="32-å®ç°resolver">3.2 å®ç°resolver</h3>
<p>resolveræ˜¯å†³å®šå¦‚ä½•ä¸ºschemaå¡«å……æ•°æ®çš„å‡½æ•°ï¼Œå¡«å……æ•°æ®å¯ä»¥æ˜¯ä»æ•°æ®åº“ç›´æ¥è¯»å–ï¼Œä¹Ÿå¯ä»¥æ˜¯è°ƒç”¨å…¶ä»–çš„APIã€‚ç±»ä¼¼äºæ¥å…¥graphqlä¹‹å‰demoé¡¹ç›®çš„controllerå®ç°ï¼›ä¸åŒçš„æ˜¯resolverå‡½æ•°ä¸­ä¸éœ€è¦æŒ‡å®šè¿”å›çš„æ•°æ®å­—æ®µï¼Œgraphql serverä¼šæ ¹æ®è¯·æ±‚è‡ªåŠ¨è¿‡æ»¤å’Œæ ¡éªŒå­—æ®µã€‚å¦‚ä¸‹ä»£ç ä¸ºæ ¹æ®schemaä¸­å®šä¹‰çš„ä¸‰ä¸ªqueryå®ç°çš„resolverå‡½æ•°ï¼š</p>
<pre><code class="language-javascript">// Provide resolver functions for your schema fields
const monk = require('monk');
const db = monk('localhost/library');
const books = db.get('books');
const authors = db.get('authors');

const resolvers = {
  Query: {
    // æ ¹æ®ä¹¦åæŸ¥è¯¢ä¹¦ç±ä¿¡æ¯
    bookList(parent, args, context, info) {
      const names = args.names;
      let params = Array.isArray(names) ? {
        name: {
          $in: names
        }
      } : {};
      return books.find(params, {
        sort: {
          img: -1
        }
      });
    },
    // æ ¹æ®idæŸ¥è¯¢ä¹¦ç±è¯¦æƒ…
    async bookDetail(parent, args, context, info){
      const id = args.id;
      const bookInfo = await books.findOne({
        _id: id
      });
      const authorInfo = await authors.findOne({
        name: bookInfo.author
      });
      let params = {
        name:{
          $in: authorInfo.books
        }
      }
      const otherBookInfos = await books.find(params);

      return {bookInfo, authorInfo:{
        ...authorInfo,
        books:otherBookInfos
      }};
    }
  },
};
module.exports = {
  resolvers
};
</code></pre>
<h3 id="33-åˆ›å»ºgraphql-server">3.3 åˆ›å»ºgraphql server</h3>
<p>åœ¨app.jsä¸­å¼•å…¥ApolloServerçš„koaä¸­é—´ä»¶ï¼ŒåŒæ—¶å¼•å…¥ä¹‹å‰å®šä¹‰çš„schemaå’Œresolverså‡½æ•°ï¼Œä½¿ç”¨ä¸­é—´ä»¶å³å¯åˆ›å»ºgraphl serverå¤„ç†graphqlè¯·æ±‚ï¼Œä¸”å¯ä¸koaæœåŠ¡ç›‘å¬åŒä¸€ä¸ªç«¯å£ï¼š</p>
<pre><code>const { ApolloServer } = require(&quot;apollo-server-koa&quot;);
const { typeDefs } = require(&quot;./graphql/schema&quot;);
const { resolvers } = require(&quot;./graphql/resolvers&quot;);

// åˆ›å»ºgraphql server
const server = new ApolloServer({
  typeDefs,
  resolvers,
  debug: false 
});

app.use(server.getMiddleware());

app.listen({ port: 8000 }, () =&gt;
  console.log(`ğŸš€ Server ready at http://localhost:8000${server.graphqlPath}`)
);
</code></pre>
<p>è‡ªæ­¤ï¼Œå¯åŠ¨nodejsæœåŠ¡æˆåŠŸåï¼Œgraphql serverä¹Ÿå¯åŠ¨æˆåŠŸäº†ï¼Œapollo serverè¿˜è´´å¿ƒåœ°é›†æˆäº†GraphQL Playgroundæ–¹ä¾¿å¼€å‘è€…è°ƒè¯•graphqlè¯·æ±‚ï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590892607994.gif" alt="" loading="lazy"></p>
<h3 id="34-è°ƒç”¨graphqlæ¥å£">3.4 è°ƒç”¨graphqlæ¥å£</h3>
<p>å‰ç«¯ä»£ç ä¸­è°ƒç”¨graphqlæ¥å£åŒæ ·éå¸¸ç®€å•ï¼Œä¸‰å¤§æ¡†æ¶åˆ†åˆ«éƒ½æœ‰å¯¹ç”¨çš„ç»„ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š@apollo/react-hooksã€vue-apolloã€Angular Apolloã€‚æœ¬æ–‡demoè™½ç„¶ä½¿ç”¨çš„æ˜¯vueæ¡†æ¶ï¼Œä½†å‰ç«¯æ²¡æœ‰é›†æˆvue-apolloç»„ä»¶ï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ¯”è¾ƒé€šç”¨çš„è°ƒç”¨æ–¹å¼ï¼š<br>
web/src/main.js</p>
<pre><code class="language-javascript">import Vue from 'vue'
import App from './App.vue'
import router from './router'
import ApolloClient from 'apollo-boost';
import { InMemoryCache } from 'apollo-cache-inmemory';
import { HttpLink } from 'apollo-link-http';

// æä¾›å®¢æˆ·ç«¯é€šè¿‡httpé“¾æ¥è¯·æ±‚graphqlæ¥å£
const httpLink = new HttpLink({
  // å¯å¢åŠ è¯·æ±‚é€‰é¡¹å’Œ http headers 
  credentials: 'same-origin'
});

const client = new ApolloClient({
  httpLink,
  cache: new InMemoryCache()  // å¤„ç†graphqlæœ¬åœ°ç¼“å­˜çš„ç»„ä»¶
});

Vue.prototype.graphqlClient = client;
Vue.config.productionTip = false;

new Vue({
  router,
  render: h =&gt; h(App)
}).$mount('#app')
</code></pre>
<p>home.vue (ä¹¦ç±åˆ—è¡¨é¡µè¯·æ±‚graphgqléƒ¨åˆ†ä»£ç )ï¼š</p>
<pre><code class="language-javascript">import { gql } from &quot;apollo-boost&quot;;
export default {
  name: &quot;List&quot;,
  data() {
    return {
      bookList: []
    };
  },
  created() {
    this.initBookList();
  },
  methods: {
    async initBookList() {
      // æŸ¥è¯¢æ‰€æœ‰ä¹¦ç±åˆ—è¡¨
      // let { bookList } = await this.postFetch(&quot;/fetchBookList&quot;, {});
      // this.bookList = bookList;
      this.getGraphqlBookList().then(res=&gt;{
        let bookList = res.data.bookList;
        this.bookList = bookList;
      })
    },
    // graphqlæ¥å£æŸ¥è¯¢ä¹¦ç±åˆ—è¡¨
    getGraphqlBookList() {
      return this.graphqlClient
        .query({
          query: gql`
            query GetBookList {
              bookList {
                _id
                name
                img
              }
            }
          `,
          fetchPolicy: 'network-only'  // default 'cache-first'
        })
    }
  }
};
</code></pre>
<p>Detail.vue (ä¹¦ç±è¯¦æƒ…é¡µè¯·æ±‚graphgqléƒ¨åˆ†ä»£ç )ï¼š</p>
<pre><code class="language-javascript">import { gql } from &quot;apollo-boost&quot;;

export default {
  name: &quot;Detail&quot;,
  data() {
    return {
      bookId: &quot;&quot;,
      bookInfo: {},
      publishBooks: []
    };
  },
  created() {
    // this.fetchDetailInfo();
    this.getGraphqlBookDetail().then(res=&gt;{
      console.log(res)
      let bookDetail = res.data.bookDetail;
      this.bookInfo = bookDetail.bookInfo;
      this.publishBooks = bookDetail.authorInfo.books;
    });
  },
  methods: {
    // graphqlæ¥å£æŸ¥è¯¢ä¹¦ç±åˆ—è¡¨
    getGraphqlBookDetail() {
      this.bookId = this.$route.params.id;
      return this.graphqlClient.query({
        query: gql`
          {
            bookDetail(id: &quot;${this.bookId}&quot;) {
              bookInfo {
                name
                img
                isbn 
                author
              }
              authorInfo {
                books {
                  name
                  img
                  isbn
                }
              }
            }
          }
        `,
        fetchPolicy: &quot;network-only&quot; // default 'cache-first'
      });
    }
  }
};
</code></pre>
<p>è¯·æ±‚graphqlæ¥å£æ—¶å‡å¯ä»¥æŒ‡å®šéœ€è¦çš„å­—æ®µï¼Œgraphql serverä¼šå¯¹æŸ¥è¯¢å‚æ•°è¿›è¡Œå¤„ç†ï¼Œåªå“åº”è¿”å›éœ€è¦çš„å­—æ®µã€‚å¦å¤–ï¼Œapollo-cache-inmemoryæ˜¯ç”¨äºgraphqlæœ¬åœ°ç¼“å­˜ç®¡ç†çš„ç»„ä»¶ï¼Œè¯·æ±‚æ—¶å¯æŒ‡å®š fetchPolicy ç¼“å­˜ç­–ç•¥ï¼Œæœ¬æ–‡ä¸æ·±å…¥è¿™å—çš„ä»‹ç»ï¼Œæ„Ÿå…´è¶£å¯è‡ªè¡Œå®è·µã€‚</p>
<h2 id="4-æ•ˆæœå¯¹æ¯”">4. æ•ˆæœå¯¹æ¯”</h2>
<h3 id="41-api-å“åº”å­—æ®µ">4.1 API å“åº”å­—æ®µ</h3>
<p>fetchBookListä¸ºæ¥å…¥graphqlå‰è¯·æ±‚ä¹¦ç±åˆ—è¡¨æ•°æ®ï¼Œgraphqlåˆ™åªè¿”å›éœ€è¦çš„å­—æ®µï¼Œç”±äºå“åº”å­—æ®µæ•°ä¸åŒï¼Œæµé‡æ¶ˆè€—ä¹Ÿä¸åŒï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590909135344.png" alt="" loading="lazy"><br>
<img src="https://xdevilj136.github.io//post-images/1590909141593.png" alt="" loading="lazy"><br>
<img src="https://xdevilj136.github.io//post-images/1590909148164.png" alt="" loading="lazy"></p>
<h3 id="42-apiè¯·æ±‚æ•°é‡">4.2 APIè¯·æ±‚æ•°é‡</h3>
<p>APIè¯·æ±‚çš„æ•°é‡å¯¹æ¯”ï¼Œæ¯”è¾ƒæ˜æ˜¾åœ¨æœ¬æ–‡demoçš„åœºæ™¯ä¸‹ï¼Œä¹¦ç±è¯¦æƒ…é¡µçš„æ•°æ®è¯·æ±‚ç”±ä¹‹å‰çš„ä¸‰æ¬¡APIè¯·æ±‚å˜ä¸ºäº†ä¸€æ¬¡ï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590909690569.png" alt="" loading="lazy"></p>
<h3 id="43-å­—æ®µæ ¡éªŒ">4.3 å­—æ®µæ ¡éªŒ</h3>
<p>å¦‚ä¸‹å›¾ï¼Œgraphqlå¯¹äºå­—æ®µåç§°å’Œç±»å‹ä¼šæœ‰ä¸¥æ ¼çš„æ ¡éªŒï¼Œæ ¡éªŒå¤±è´¥ä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œé”™è¯¯æ ˆä¿¡æ¯ï¼š<br>
<img src="https://xdevilj136.github.io//post-images/1590909985620.png" alt="" loading="lazy"><br>
è€Œæœªä½¿ç”¨graphqlçš„æƒ…å†µä¸‹ï¼Œè‹¥æ¥å£å­—æ®µæœ‰å˜åŠ¨è€Œå‰ç«¯æ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¾€å¾€ä¼šç›´æ¥å‘ˆç°ä¸ºé¡µé¢BUGï¼Œä¸”éš¾ä»¥å®šä½ã€‚</p>
<p>æœ¬æ–‡demoä»£ç å‡åœ¨ï¼š<br>
https://github.com/xdevilj136/graphql-koa-demo</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-graphql%E7%AE%80%E4%BB%8B">1. GraphQLç®€ä»‹</a>
<ul>
<li><a href="#11-graphql">1.1 GraphQL</a></li>
<li><a href="#12-apollo-graphql%E7%BB%84%E4%BB%B6">1.2 Apollo Graphqlç»„ä»¶</a></li>
</ul>
</li>
<li><a href="#2-demo%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">2. demoé¡¹ç›®ä»‹ç»</a>
<ul>
<li><a href="#21-%E6%8A%80%E6%9C%AF%E6%A0%88">2.1 æŠ€æœ¯æ ˆ</a></li>
<li><a href="#22-%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA">2.2 é¡µé¢å±•ç¤º</a></li>
<li><a href="#23-%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">2.3 é—®é¢˜åˆ†æ</a></li>
</ul>
</li>
<li><a href="#3-%E6%8E%A5%E5%85%A5graphql">3. æ¥å…¥GraphQL</a>
<ul>
<li><a href="#31-%E5%AE%9A%E4%B9%89schema">3.1 å®šä¹‰schema</a></li>
<li><a href="#32-%E5%AE%9E%E7%8E%B0resolver">3.2 å®ç°resolver</a></li>
<li><a href="#33-%E5%88%9B%E5%BB%BAgraphql-server">3.3 åˆ›å»ºgraphql server</a></li>
<li><a href="#34-%E8%B0%83%E7%94%A8graphql%E6%8E%A5%E5%8F%A3">3.4 è°ƒç”¨graphqlæ¥å£</a></li>
</ul>
</li>
<li><a href="#4-%E6%95%88%E6%9E%9C%E5%AF%B9%E6%AF%94">4. æ•ˆæœå¯¹æ¯”</a>
<ul>
<li><a href="#41-api-%E5%93%8D%E5%BA%94%E5%AD%97%E6%AE%B5">4.1 API å“åº”å­—æ®µ</a></li>
<li><a href="#42-api%E8%AF%B7%E6%B1%82%E6%95%B0%E9%87%8F">4.2 APIè¯·æ±‚æ•°é‡</a></li>
<li><a href="#43-%E5%AD%97%E6%AE%B5%E6%A0%A1%E9%AA%8C">4.3 å­—æ®µæ ¡éªŒ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://xdevilj136.github.io/post/css-flash-animation/">
              <h3 class="post-title">
                csså®ç°é—ªå…‰åŠ¨æ•ˆ
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://xdevilj136.github.io//atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
